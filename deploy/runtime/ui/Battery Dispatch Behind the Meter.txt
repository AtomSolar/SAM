Battery Dispatch Behind the Meter
1001
232
10
GroupBox

1
7
Name
5
21
DispatchTimingControl
X
3
9
Y
3
3
Width
3
985
Height
3
226
Caption
5
27
Storage Dispatch Controller
Bold
2
1
RadioChoice

1
10
Name
5
20
batt_dispatch_choice
X
3
33
Y
3
48
Width
3
246
Height
3
96
Selection
3
0
Items
6
4
Peak shaving: 1-day look ahead
Peak shaving: 1-day look behind
Automated grid power target
Manual dispatch
ShowCaptions
2
1
Horizontal
2
0
TabOrder
3
4294967295
Label

1
12
Name
5
23
batt_manual_description
X
3
297
Y
3
45
Width
3
393
Height
3
117
Caption
5
282
The manual dispatch model aims to minimize purchases from the grid.  It first tries to meet load with PV, then battery, then grid. Choose whether PV should meet the load or charge the battery below. Use the timing controls to constrain the battery controller.  See help for details.
TextColour
4
0
0
0
255
Bold
2
0
FontSize
3
0
WordWrap
2
1
AlignRight
2
0
AlignTop
2
1
RadioChoice

1
10
Name
5
14
batt_pv_choice
X
3
297
Y
3
162
Width
3
357
Height
3
54
Selection
3
0
Items
6
2
PV meets load before charging battery
PV charges battery before meeting load
ShowCaptions
2
1
Horizontal
2
0
TabOrder
3
4294967295
Choice

1
8
Name
5
18
batt_target_choice
X
3
717
Y
3
48
Width
3
201
Height
3
24
Items
6
2
Enter single or monthly powers
Enter time series powers
Selection
3
4294967295
TabOrder
3
4294967295
DataArray

1
9
Name
5
17
batt_target_power
X
3
828
Y
3
105
Width
3
90
Height
3
24
Mode
3
1
Label
5
17
Grid target power
Description
5
130
The grid target power is the maximum desired power drawn from the grid over each timestep after contributions from PV and battery.
TabOrder
3
4294967295
MonthlyFactor

1
7
Name
5
25
batt_target_power_monthly
X
3
828
Y
3
78
Width
3
90
Height
3
24
Description
5
17
Single or monthly
TabOrder
3
4294967295
Divider

1
9
Name
5
9
object 21
X
3
21
Y
3
27
Width
3
258
Height
3
16
Orientation
3
0
Colour
4
120
120
120
255
Caption
5
21
Choose Dispatch Model
Bold
2
1
Divider

1
9
Name
5
10
object 218
X
3
297
Y
3
27
Width
3
342
Height
3
16
Orientation
3
0
Colour
4
120
120
120
255
Caption
5
23
Manual dispatch options
Bold
2
1
Divider

1
9
Name
5
9
object 22
X
3
660
Y
3
27
Width
3
306
Height
3
16
Orientation
3
0
Colour
4
120
120
120
255
Caption
5
33
Automated Grid Power Target Model
Bold
2
1

5
batt_dispatch_choice
3
1
Battery dispatch choice
 
Battery
106
Peak shaving: 1-day look ahead|Peak shaving: 1-day look behind|Automated grid power target|Manual dispatch
3
1
1
1
1
3
RadioChoice
batt_pv_choice
3
1
PV priority (0=load,1=battery)
 
Battery
0
3
1
1
1
1
0
RadioChoice
batt_target_choice
3
1
 
 
Battery
0
1
1
1
1
1
0
Choice
batt_target_power
3
2
Time series
kW
Battery
0
0
1
2
1
1
15
DataArray
batt_target_power_monthly
3
2
Single or monthly
kW
Battery
0
0
1
2
1
1
0
MonthlyFactor

0
3679
on_load{'Battery Dispatch Behind the Meter'}=define()
{	
	toggle_dispatch();
		
	on_change{'batt_dispatch_choice'};
	on_change{'batt_target_choice'};
};

on_change{'batt_dispatch_choice'}=define(){toggle_dispatch();};
on_change{'batt_target_choice'} = define(){toggle_dispatch_target();};

function toggle_dispatch()
{
	mode = ${batt_dispatch_choice};
	if (mode != 3)
		enable_manual_inputs(false);
	else
	{
		enable_manual_inputs(true);
		toggle_discharge_percent();
		toggle_gridcharge_percent();
	}
	toggle_dispatch_target();
}
function toggle_dispatch_target()
{
	mode = ${batt_dispatch_choice};
	if (mode != 2)
		enable_target_inputs(false);
	else
		enable_target_inputs(true);
}
function toggle_discharge_percent()
{
	enable('batt_discharge_percent_1', (value('pv.storage.p1.discharge')==1));
	enable('batt_discharge_percent_2', (value('pv.storage.p2.discharge')==1));
	enable('batt_discharge_percent_3', (value('pv.storage.p3.discharge')==1));
	enable('batt_discharge_percent_4', (value('pv.storage.p4.discharge')==1));
	enable('batt_discharge_percent_5', (value('pv.storage.p5.discharge')==1));
	enable('batt_discharge_percent_6', (value('pv.storage.p6.discharge')==1));
}
function toggle_gridcharge_percent()
{
	enable('batt_gridcharge_percent_1', (value('pv.storage.p1.gridcharge')==1));
	enable('batt_gridcharge_percent_2', (value('pv.storage.p2.gridcharge')==1));
	enable('batt_gridcharge_percent_3', (value('pv.storage.p3.gridcharge')==1));
	enable('batt_gridcharge_percent_4', (value('pv.storage.p4.gridcharge')==1));
	enable('batt_gridcharge_percent_5', (value('pv.storage.p5.gridcharge')==1));
	enable('batt_gridcharge_percent_6', (value('pv.storage.p6.gridcharge')==1));
}
function enable_target_inputs(on_off)
{
	if (!on_off)
	{
		enable('batt_target_choice',on_off);
		enable('batt_target_power',on_off);
		enable('batt_target_power_monthly',on_off);
	}
	else 
	{
		enable('batt_target_choice',true);
		mode = ${batt_target_choice};
		if (mode == 0)
		{
			enable('batt_target_power',false);
			enable('batt_target_power_monthly',true);
		}
		else
		{
			enable('batt_target_power',true);
			enable('batt_target_power_monthly',false);
		}
			
	}
}
function enable_manual_inputs(on_off)
{
	enable('pv.storage.p1.gridcharge',on_off);
	enable('pv.storage.p2.gridcharge',on_off);
	enable('pv.storage.p3.gridcharge',on_off);
	enable('pv.storage.p4.gridcharge',on_off);
	enable('pv.storage.p5.gridcharge',on_off);
	enable('pv.storage.p6.gridcharge',on_off);
	enable('pv.storage.p1.charge',on_off);
	enable('pv.storage.p2.charge',on_off);
	enable('pv.storage.p3.charge',on_off);
	enable('pv.storage.p4.charge',on_off);
	enable('pv.storage.p5.charge',on_off);
	enable('pv.storage.p6.charge',on_off);
	enable('pv.storage.p1.discharge',on_off);
	enable('pv.storage.p2.discharge',on_off);
	enable('pv.storage.p3.discharge',on_off);
	enable('pv.storage.p4.discharge',on_off);
	enable('pv.storage.p5.discharge',on_off);
	enable('pv.storage.p6.discharge',on_off);
	enable('batt_discharge_percent_1',on_off);
	enable('batt_discharge_percent_2',on_off);
	enable('batt_discharge_percent_3',on_off);
	enable('batt_discharge_percent_4',on_off);
	enable('batt_discharge_percent_5',on_off);
	enable('batt_discharge_percent_6',on_off);
	enable('batt_gridcharge_percent_1',on_off);
	enable('batt_gridcharge_percent_2',on_off);
	enable('batt_gridcharge_percent_3',on_off);
	enable('batt_gridcharge_percent_4',on_off);
	enable('batt_gridcharge_percent_5',on_off);
	enable('batt_gridcharge_percent_6',on_off);
	enable('dispatch_manual_sched',on_off);
	enable('dispatch_manual_sched_weekend',on_off);

	if (on_off == false)
		${batt_pv_choice} = 0;
	
	enable('batt_pv_choice',on_off);
}
